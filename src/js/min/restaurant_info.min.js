let restaurant,reviews;var map;window.initMap=(()=>{fetchRestaurantFromURL((error,restaurant)=>{error?console.log("Error (window.initMap): "+error):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:restaurant.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),window.addEventListener("online",()=>{DBHelper.saveAwaitingReviewFromForm()}),fetchRestaurantFromURL=(callback=>{if(self.restaurant)return callback(null,self.restaurant);const id=getParameterByName("id");id?DBHelper.fetchRestaurantById(id,(error,restaurant)=>{if(self.restaurant=restaurant,!restaurant)return console.log("Error (fetchRestaurantFromURL): "+error);fillRestaurantHTML(),callback(null,restaurant)}):callback("No restaurant id in URL",null)}),fillRestaurantHTML=((restaurant=self.restaurant)=>{const name=document.getElementById("restaurant-name");name.innerHTML=restaurant.name;const address=document.getElementById("restaurant-address");address.innerHTML=restaurant.address;const image=document.getElementById("restaurant-img");image.className="restaurant-img";const source=DBHelper.imageUrlForRestaurant(restaurant)+".jpg";image.src=source,image.alt=restaurant.name+"restaurant main image";const cuisine=document.getElementById("restaurant-cuisine");cuisine.innerHTML=restaurant.cuisine_type,restaurant.operating_hours&&fillRestaurantHoursHTML();const form=document.querySelector("#review-form");form.action=`${DBHelper.DATABASE_URL}/reviews/`,DBHelper.fetchReviewsByRestaurantId(restaurant.id,(error,reviews)=>{if(self.reviews=reviews,!reviews)return console.log("Error (fillRestaurantHTML): "+error);fillReviewsHTML()})}),fillRestaurantHoursHTML=((operatingHours=self.restaurant.operating_hours)=>{const hours=document.getElementById("restaurant-hours");for(let key in operatingHours){const row=document.createElement("tr"),day=document.createElement("td");day.innerHTML=key,row.appendChild(day);const time=document.createElement("td");time.innerHTML=operatingHours[key],row.appendChild(time),hours.appendChild(row)}}),fillReviewsHTML=((reviews=self.reviews)=>{const container=document.getElementById("reviews-container"),title=document.createElement("h2");if(title.innerHTML="Reviews",container.appendChild(title),!reviews){const noReviews=document.createElement("p");return noReviews.innerHTML="No reviews yet!",void container.appendChild(noReviews)}const ul=document.getElementById("reviews-list");reviews.forEach(review=>{ul.appendChild(createReviewHTML(review))}),container.appendChild(ul);const form=document.querySelector("#review-form");form.addEventListener("submit",e=>{DBHelper.saveReviewFromForm(e,(error,review)=>{if(!review)return console.log("Error (fillReviewsHTML): "+error);reviews.push(review),resetReviews(reviews),fillReviewsHTML()}),form.reset()})}),resetReviews=(reviews=>{self.reviews=[];const container=document.getElementById("reviews-container");container.innerHTML="";const ul=document.createElement("ul");ul.id="reviews-list",container.appendChild(ul),self.reviews=reviews}),createReviewHTML=(review=>{const li=document.createElement("li"),data=document.createElement("p"),date=new Date(review.updatedAt);data.innerHTML="On : "+date.toLocaleDateString()+" "+review.name+" gave "+review.rating+" star(s) and wrote : ",li.appendChild(data);const comments=document.createElement("p");return comments.innerHTML=review.comments,li.appendChild(comments),li}),fillBreadcrumb=((restaurant=self.restaurant)=>{const breadcrumb=document.getElementById("breadcrumb"),li=document.createElement("li");li.innerHTML=restaurant.name,breadcrumb.appendChild(li)}),getParameterByName=((name,url)=>{url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");const regex=new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null});