let restaurants,neighborhoods,cuisines;var map,markers=[];document.addEventListener("DOMContentLoaded",event=>{fetchNeighborhoods(),fetchCuisines()}),window.initMap=(()=>{let loc={lat:40.722216,lng:-73.987501};self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:loc,scrollwheel:!1}),updateRestaurants()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((error,neighborhoods)=>{error?console.error(error):(self.neighborhoods=neighborhoods,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((neighborhoods=self.neighborhoods)=>{const select=document.getElementById("neighborhoods-select");neighborhoods.forEach(neighborhood=>{const option=document.createElement("option");option.innerHTML=neighborhood,option.value=neighborhood,select.append(option)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((error,cuisines)=>{error?console.error(error):(self.cuisines=cuisines,fillCuisinesHTML())})}),fillCuisinesHTML=((cuisines=self.cuisines)=>{const select=document.getElementById("cuisines-select");cuisines.forEach(cuisine=>{const option=document.createElement("option");option.innerHTML=cuisine,option.value=cuisine,select.append(option)})}),updateRestaurants=(()=>{const cSelect=document.getElementById("cuisines-select"),nSelect=document.getElementById("neighborhoods-select"),fSelect=document.getElementById("favourite-select"),cIndex=cSelect.selectedIndex,nIndex=nSelect.selectedIndex,fvalue=fSelect.checked,cuisine=cSelect[cIndex].value,neighborhood=nSelect[nIndex].value,favourite=fvalue;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood,favourite,(error,restaurants)=>{error?console.error(error):(resetRestaurants(restaurants),fillRestaurantsHTML())})}),resetRestaurants=(restaurants=>{self.restaurants=[];const ul=document.getElementById("restaurants-list");ul.innerHTML="",self.markers.forEach(m=>m.setMap(null)),self.markers=[],self.restaurants=restaurants}),fillRestaurantsHTML=((restaurants=self.restaurants)=>{let tabIndex=3;const ul=document.getElementById("restaurants-list");restaurants.forEach(restaurant=>{ul.append(createRestaurantHTML(restaurant,tabIndex)),tabIndex++}),addMarkersToMap()}),createRestaurantHTML=((restaurant,tabIndex)=>{const li=document.createElement("li"),favorite=document.createElement("div");favorite.setAttribute("id","restaurant-favorite"),favorite.innerHTML=restaurant.is_favorite;let btn=document.createElement("button");btn.setAttribute("div","restaurant-favorite-btn"),"true"==restaurant.is_favorite?(btn.innerHTML=" Remove from Favorite",btn.setAttribute("onclick",`DBHelper.changeFavorite(${restaurant.id}, false);`)):(btn.innerHTML="Add to Favorite",btn.setAttribute("onclick",`DBHelper.changeFavorite(${restaurant.id}, true);`)),li.appendChild(btn);const picture=document.createElement("picture"),fileName=DBHelper.fileNameForRestaurant(restaurant)+".jpg";picture.className="restaurant-img",picture.innerHTML='<source media="(min-width: 750px)" srcset="/img/large/'+fileName+'"><source media="(min-width: 500px)" srcset="/img/medium/'+fileName+'"><img class="lazy" src="/img/small/'+fileName+'" alt="Main image of '+restaurant.name+' restaurant">',li.append(picture);const name=document.createElement("h2");name.innerHTML=restaurant.name,li.append(name);const neighborhood=document.createElement("p");neighborhood.innerHTML=restaurant.neighborhood,li.append(neighborhood);const address=document.createElement("p");address.innerHTML=restaurant.address,li.append(address);const more=document.createElement("a");return more.innerHTML="View Details",more.setAttribute("tabindex",tabIndex.toString()),more.setAttribute("aria-label","More details about "+restaurant.name),more.href=DBHelper.urlForRestaurant(restaurant),li.append(more),li}),addMarkersToMap=((restaurants=self.restaurants)=>{restaurants.forEach(restaurant=>{const marker=DBHelper.mapMarkerForRestaurant(restaurant,self.map);google.maps.event.addListener(marker,"click",()=>{window.location.href=marker.url}),self.markers.push(marker)})});